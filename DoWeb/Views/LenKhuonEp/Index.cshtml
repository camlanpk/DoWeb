
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/MyStyle.css" rel="stylesheet" />
<script src="~/Scripts/MyScript.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<link href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" rel="stylesheet" />
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

<h2>Danh sách lên khuôn ép</h2>
<button class="btn btn-primary" onclick="openPopup('@Url.Action("Create")')">Thêm mới</button>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>ID</th>
            <th>Tên khuôn</th>
            <th>Hot Runner</th>
            <th>Tên máy</th>
            <th>Điểm TB</th>
            <th>Xếp loại</th>
        </tr>
        @foreach (var a in Model)
        {
            <tr>
                <th>
                    @a.ID
                </th>
                <th>
                    @(a.MayKhuon1?.TenMayKhuon ?? "Không có")
                </th>
                <th>
                    @a.HotRunner
                </th>
                <th>
                    @(a.MayKhuon?.TenMayKhuon ?? "Không có")
                </th>
                <th>
                    @a.DiemTB
                </th>
                <th>
                    @a.XepLoai
                </th>
            </tr>
        }
    </thead>
</table>

<div class="modal fade" id="formModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
        </div>
    </div>
</div>

<script>function openPopup(url) {         $("#formModal .modal-content").load(url, function () {             $("#formModal").modal("show");         });     }      $(document).on("submit", "form", function (e) {         e.preventDefault();         var form = $(this);         $.ajax({             type: form.attr("method"),             url: form.attr("action"),             data: form.serialize(),             success: function (res) {                 if (res.success) {                     location.reload();                 } else {                     $("#formModal .modal-content").html(res);                 }             }         });     });</script>
<script>$("#searchBox").on("keyup", function () {         var filter = $(this).val().toLowerCase();         $("#ddlMayKhuon option").each(function () {             var text = $(this).text().toLowerCase();             if (text.includes(filter) || $(this).val() === "") {                 $(this).show();             } else {                 $(this).hide();             }         });     });</script>
<script>function closePopup() {         $("#formModal").modal("hide");     }</script>
<script>     $(function () {         $('.select2').select2({             width: '100%',             placeholder: "Nhập để tìm...",             allowClear: true         });     });</script>
<script>function closePopup() {         $("#formModal").modal("hide");                 function openPopup(url) {             $("#formModal .modal-content").load(url, function () {                 $("#formModal").modal("show");             });         }          $(document).on("submit", "form", function (e) {             e.preventDefault();             var form = $(this);             $.ajax({                 type: form.attr("method"),                 url: form.attr("action"),                 data: form.serialize(),                 success: function (res) {                     if (res.success) {                         location.reload();                     } else {                         $("#formModal .modal-content").html(res);                     }                 }             });         });</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function () {
    $("#searchInput").on("keyup", function () {
        var searchValue = $(this).val();

        if (searchValue.length < 1) {
            $("#searchResults").hide();
            return;
        }

        $.ajax({
            url: '@Url.Action("SearchMayKhuon", "Home")',
            type: 'GET',
            data: { searchString: searchValue },
            success: function (data) {
                var $list = $("#searchResults");
                $list.empty();

                if (data.length > 0) {
                    $.each(data, function (i, item) {
                        $list.append('<li class="list-group-item list-group-item-action">' + item.TenMayKhuon + '</li>');
                    });
                    $list.show();
                } else {
                    $list.hide();
                }
            }
        });
    });

    // Khi chọn 1 mục trong dropdown
    $(document).on("click", "#searchResults li", function () {
        $("#searchInput").val($(this).text());
        $("#searchResults").hide();
    });

    // Ẩn dropdown khi click ra ngoài
    $(document).on("click", function (e) {
        if (!$(e.target).closest('#searchInput').length) {
            $("#searchResults").hide();
        }
    });
});
</script>

